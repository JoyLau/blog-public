
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>重剑无锋,大巧不工 SpringBoot --- 环境集成 - JoyLau&#39;s Blog | JoyLau</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="JoyLau,Blog,JoyLau&#39;s Blog,"> 
    <meta name="description" content="JoyLau的技术学习与思考,JoyLau的个人博客,刘法的技术学习与思考,刘法的个人博客。,

SpringBoot文章推荐
重剑无锋,大巧不工 SpringBoot — 基础篇
重剑无锋,大巧不工 SpringBoot — 探索篇
重剑无锋,大巧不工 SpringBoot — 环境集成
,"> 
    <meta name="author" content="JoyLau"> 
    <link rel="alternative" href="atom.xml" title="JoyLau&#39;s Blog | JoyLau" type="application/atom+xml"> 
    <link rel="icon" href="http://image.joylau.cn/favicon.ico"> 
    <meta name="baidu-site-verification" content="YKshmF02SZ" />
    
<link rel="stylesheet" href="/css/font.css">

    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1429596_nzgqgvnmkjb.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_1792772_esp1kuicf2e.css">

    
<link rel="stylesheet" href="/css/animate.css/3.7.2/animate.min.css">

    
<link rel="stylesheet" href="/css/ajax/libs/social-share.js/1.0.16/css/share.min.css">

    
<link rel="stylesheet" href="/css/codemirror/5.53.2/codemirror.min.css">

    
<link rel="stylesheet" href="/css/codemirror/5.53.2/theme/dracula.css">

    
<link rel="stylesheet" href="/css/obsidian.css">

    
<link rel="stylesheet" href="/css/ball-atom.min.css">

<meta name="generator" content="Hexo 4.2.1"></head>


<body class="loading">
    <div class="loader">
        <div class="la-ball-atom la-2x">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <span id="config-title" style="display:none">JoyLau&#39;s Blog | JoyLau</span>
    <div id="loader"></div>
    <div id="single">
    <div class="scrollbar gradient-bg-rev"></div>
<div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <div class="navigation animated fadeIn fast delay-1s">
        <img id="home-icon" style="border-radius:50%" class="icon-home" src="http://image.joylau.cn/blog/JoyLau.jpg" alt="" data-url="http://blog.joylau.cn">
        <div id="play-icon" title="Play/Pause" class="iconfont icon-play"></div>
        <h3 class="subtitle">重剑无锋,大巧不工 SpringBoot --- 环境集成</h3>
        <div class="social">
            <!--        <div class="like-icon">-->
            <!--            <a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
            <!--        </div>-->
            <div>
                <div class="share">
                    
                        <a href="javascript:;" class="iconfont icon-share1"></a>
                        <div class="share-component-cc" data-disabled="facebook,douban,linkedin,diandian,tencent,google"></div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="section">
        <div class=article-header-wrapper>
    <div class="article-header">
        <div class="article-cover animated fadeIn" style="
            animation-delay: 600ms;
            animation-duration: 1.2s;
            background-image: 
                radial-gradient(ellipse closest-side, rgba(0, 0, 0, 0.65), #100e17),
                url(//image.joylau.cn/blog/SpringBoot-Integrate.png?0.29968286260663524) ">
        </div>
        <div class="else">
            <p class="animated fadeInDown">
                
                <a href="/categories/SpringBoot篇"><b>「
                    </b>SPRINGBOOT篇<b> 」</b></a>
                
                三月 14, 2017
            </p>
            <h3 class="post-title animated fadeInDown"><a href="/2017/03/14/SpringBoot-Integrate/" title="重剑无锋,大巧不工 SpringBoot --- 环境集成" class="">重剑无锋,大巧不工 SpringBoot --- 环境集成</a>
            </h3>
            
            <p class="post-count animated fadeInDown">
                
                <span>
                    <b class="iconfont icon-text2"></b> <i>文章字数</i>
                    27k
                </span>
                
                
                <span>
                    <b class="iconfont icon-timer__s"></b> <i>阅读约需</i>
                    25 mins.
                </span>
                
                
                
                <span id="busuanzi_container_page_pv">
                    <b class="iconfont icon-read"></b> <i>阅读次数</i>
                    <span id="busuanzi_value_page_pv_copy"></span>
                </span>
                
            </p>
            
            
            <ul class="animated fadeInDown post-tags-list" itemprop="keywords"><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li></ul>
            
        </div>
    </div>
</div>

<div class="screen-gradient-after">
    <div class="screen-gradient-content">
        <div class="screen-gradient-content-inside">
            <div class="bold-underline-links screen-gradient-sponsor">
                <p>
                    <span class="animated fadeIn delay-1s"></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="article">
    <div class='main'>
        <div class="content markdown animated fadeIn">
            <a id="more"></a>
<p><img src="//image.joylau.cn/blog/SpringBoot-build-better-enterprise.png" alt="build-better-enterprise"></p>
<h2 id="SpringBoot文章推荐"><a href="#SpringBoot文章推荐" class="headerlink" title="SpringBoot文章推荐"></a>SpringBoot文章推荐</h2><ul>
<li><a href="/2017/03/13/SpringBoot-Basic/">重剑无锋,大巧不工 SpringBoot — 基础篇</a></li>
<li><a href="/2017/03/14/SpringBoot-Research/">重剑无锋,大巧不工 SpringBoot — 探索篇</a></li>
<li><a href="/2017/03/14/SpringBoot-Integrate/">重剑无锋,大巧不工 SpringBoot — 环境集成</a></li>
<li><a href="/2017/03/21/SpringBoot-SpringBatch/">重剑无锋,大巧不工 SpringBoot — 批处理SpringBatch</a></li>
<li><a href="/2017/06/12/SpringBoot-RequestBody/">重剑无锋,大巧不工 SpringBoot — @RequestBody JSON参数处理</a></li>
<li><a href="/2017/06/12/SpringBoot-Question-Tips/">重剑无锋,大巧不工 SpringBoot — 项目问题汇总及解决</a></li>
<li><a href="/2017/06/13/SpringBoot-ConfigurationProperties/">重剑无锋,大巧不工 SpringBoot — 属性注入</a></li>
<li><a href="/2017/06/16/SpringBoot-RabbitMQ/">重剑无锋,大巧不工 SpringBoot — 整合RabbitMQ</a></li>
<li><a href="/2017/06/18/SpringBoot-RESTfulAPI/">重剑无锋,大巧不工 SpringBoot — RESTful API</a></li>
<li><a href="/2017/07/18/SpringBoot-MongoDB/">重剑无锋,大巧不工 SpringBoot — 整合使用MongoDB</a></li>
<li><a href="/2017/09/19/SpringBoot-CaffeineCache/">重剑无锋,大巧不工 SpringBoot — 推荐使用CaffeineCache</a></li>
</ul>
<h2 id="SpringBoot项目实战"><a href="#SpringBoot项目实战" class="headerlink" title="SpringBoot项目实战"></a>SpringBoot项目实战</h2><ul>
<li><a href="/2017/07/24/SpringBoot-JoyMedia/">重剑无锋,大巧不工 SpringBoot — 实战项目 JoyMedia （ 分析篇 ）</a></li>
<li><a href="/2017/07/29/SpringBoot-JoyMedia-Node/">重剑无锋,大巧不工 SpringBoot — 实战项目 JoyMedia （ Node篇 ）</a></li>
<li><a href="/2017/08/06/SpringBoot-JoyMedia-Search/">重剑无锋,大巧不工 SpringBoot — 实战项目 JoyMedia （ 搜索篇 ）</a></li>
<li><a href="/2017/08/20/SpringBoot-JoyMedia-MV/">重剑无锋,大巧不工 SpringBoot — 实战项目 JoyMedia （ MV 篇 ）</a></li>
<li><a href="/2017/08/29/SpringBoot-JoyMedia-NoReferer/">重剑无锋,大巧不工 SpringBoot — 实战项目 JoyMedia （ NoReferer篇 ）</a></li>
</ul>
<blockquote>
<p>不啰嗦，直接上代码</p>
</blockquote>
<h2 id="集成Druid"><a href="#集成Druid" class="headerlink" title="集成Druid"></a>集成Druid</h2><h3 id="DruidConfig"><a href="#DruidConfig" class="headerlink" title="DruidConfig:"></a>DruidConfig:</h3><pre><code class="java">    /**
     * Created by LiuFa on 2016/9/14.
     * cn.lfdevelopment.www.sys.druid
     * DevelopmentApp
     */
    @Configuration
    public class DruidConfig{

        private Logger logger = LoggerFactory.getLogger(getClass());

        @Bean(initMethod = &quot;init&quot;, destroyMethod = &quot;close&quot;)
        @ConfigurationProperties(prefix=&quot;spring.datasource&quot;)
        public DataSource druidDataSource(){
            return new DruidDataSource() {
                @Override
                public void setUsername(String username) {
                    try {
                        username = ConfigTools.decrypt(username);
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                    super.setUsername(username);
                }

                @Override
                public void setUrl(String jdbcUrl) {
                    try {
                        jdbcUrl = ConfigTools.decrypt(jdbcUrl);
                    } catch (Exception e) {
                        e.printStackTrace();
                    }
                    super.setUrl(jdbcUrl);
                }
            };
        }
    }</code></pre>
<h3 id="DruidStatViewConfig"><a href="#DruidStatViewConfig" class="headerlink" title="DruidStatViewConfig:"></a>DruidStatViewConfig:</h3><pre><code class="java">    /**
     * Created by LiuFa on 2016/8/8.
     * cn.lfdevelopment.www.sys.druid
     * DevelopmentApp
     * 这样的方式不需要添加注解：@ServletComponentScan
     */
    @Configuration
    public class DruidStatViewConfig {

        @Value(&quot;${spring.druid.loginUsername}&quot;)
        private String loginUsername;

        @Value(&quot;${spring.druid.loginPassword}&quot;)
        private String loginPassword;

        /**
         * 注册一个StatViewServlet
         * 使用Druid的内置监控页面
         */
        @Bean
        public ServletRegistrationBean DruidStatViewServlet() {
            ServletRegistrationBean servletRegistrationBean = new ServletRegistrationBean(new StatViewServlet(),
                    &quot;/druid/*&quot;);
            //添加初始化参数：initParams
            //白名单
            //ip配置规则
            //配置的格式
            //&lt;IP&gt; 或者 &lt;IP&gt;/&lt;SUB_NET_MASK_size&gt; 多个ip地址用逗号隔开
            //其中
            //128.242.127.1/24
            //24表示，前面24位是子网掩码，比对的时候，前面24位相同就匹配。
            //由于匹配规则不支持IPV6，配置了allow或者deny之后，会导致IPV6无法访问。
            servletRegistrationBean.addInitParameter(&quot;allow&quot;, &quot;&quot;);

            //deny优先于allow，如果在deny列表中，就算在allow列表中，也会被拒绝。
            //如果allow没有配置或者为空，则允许所有访问
            //IP黑名单 (存在共同时，deny优先于allow) : 如果满足deny的话提示:Sorry, you are not permitted to view this page.
            servletRegistrationBean.addInitParameter(&quot;deny&quot;, &quot;&quot;);

            //登录查看信息的账号密码.
            try {
                servletRegistrationBean.addInitParameter(&quot;loginUsername&quot;, ConfigTools.decrypt(loginUsername));
                servletRegistrationBean.addInitParameter(&quot;loginPassword&quot;, ConfigTools.decrypt(loginPassword));
            } catch (Exception e) {
                e.printStackTrace();
            }

            //是否能够重置数据.
            servletRegistrationBean.addInitParameter(&quot;resetEnable&quot;, &quot;true&quot;);

            return servletRegistrationBean;
        }

        /**
         * 注册一个：filterRegistrationBean
         * 内置监控中的Web关联监控的配置
         */
        @Bean
        public FilterRegistrationBean druidStatFilter() {
            FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean(new WebStatFilter());

            //添加过滤规则.
            filterRegistrationBean.addUrlPatterns(&quot;/*&quot;);

            //排除一些不必要的url
            filterRegistrationBean.addInitParameter(&quot;exclusions&quot;, &quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;);
            //缺省sessionStatMaxCount是1000个,这里设置了3000个
            filterRegistrationBean.addInitParameter(&quot;sessionStatMaxCount&quot;, &quot;3000&quot;);
            //可以配置principalCookieName，使得druid知道指定的sessionName是谁
    //        filterRegistrationBean.addInitParameter(&quot;principalSessionName&quot;, &quot;sessionId&quot;);
            //druid 0.2.7版本开始支持profile，配置profileEnable能够监控单个url调用的sql列表。
            filterRegistrationBean.addInitParameter(&quot;profileEnable&quot;, &quot;true&quot;);
            return filterRegistrationBean;
        }

        /**
         * 注册一个:druidStatInterceptor
         */
        /*@Bean
        public DruidStatInterceptor druidStatInterceptor(){
            return new DruidStatInterceptor();
        }*/

        /**
         * 注册一个：beanNameAutoProxyCreator
         * 内置监控中的spring关联监控的配置
         * 该方法使用的是按照BeanId来拦截配置，还有2种方法，分别是
         * 按类型拦截配置
         * 方法名正则匹配拦截配置
         */
        /*@Bean
        public BeanNameAutoProxyCreator beanNameAutoProxyCreator(){
            BeanNameAutoProxyCreator beanNameAutoProxyCreator = new BeanNameAutoProxyCreator();
            beanNameAutoProxyCreator.setProxyTargetClass(true);
            beanNameAutoProxyCreator.setBeanNames(&quot;*Controller&quot;);
            beanNameAutoProxyCreator.setInterceptorNames(&quot;druidStatInterceptor&quot;);
            return beanNameAutoProxyCreator;
        }*/
    }
</code></pre>
<h3 id="application-dev"><a href="#application-dev" class="headerlink" title="application-dev:"></a>application-dev:</h3><pre><code class="properties">    #druid配置
    spring.datasource.type=com.alibaba.druid.pool.DruidDataSource
    spring.datasource.driver-class-name=com.mysql.jdbc.Driver
    spring.datasource.url=G11Jor+OrLz9MFztdkOfqRnrJKVrFCDdBbYJFmB0qGjUARxPr2tiyRzUn4xbnk/XqPgM8PMjdIJ/pO8UF4aeVg==
    spring.datasource.username=bNVOqb7WKLX5Bjnw+LMv92taj25KOxDimXxILPQjw42wgv+1lHzOH8kr97xDwWdhpY67QuYCS7sWN4W46YbkFA==
    spring.datasource.password=l65GeQaXVXxx2ogcQeZLAFM7VcPwgzc9202vxql4hjCbjM8dVm/sD4osdvaBdVkC+BiYdnYL2EzpaCysXAZ5Gw==


    # 下面为连接池的补充设置，应用到上面所有数据源中
    # 初始化大小，最小，最大
    spring.datasource.initialSize=10
    spring.datasource.minIdle=25
    spring.datasource.maxActive=250

    # 配置获取连接等待超时的时间
    spring.datasource.maxWait=60000

    # 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒
    spring.datasource.timeBetweenEvictionRunsMillis=1200000

    # 配置一个连接在池中最小生存的时间，单位是毫秒
    spring.datasource.minEvictableIdleTimeMillis=1800000

    spring.datasource.validationQuery=SELECT &#39;x&#39;

    #建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效。
    spring.datasource.testWhileIdle=true

    #申请连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。
    spring.datasource.testOnBorrow=false

    #归还连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能
    spring.datasource.testOnReturn=false

    # 打开PSCache，并且指定每个连接上PSCache的大小  如果用Oracle，则把poolPreparedStatements配置为true，mysql可以配置为false。分库分表较多的数据库，建议配置为false 在mysql5.5以下的版本中没有PSCache功能，建议关闭掉。5.5及以上版本有PSCache，建议开启。
    spring.datasource.poolPreparedStatements=true

    # 配置监控统计拦截的filters，去掉后监控界面sql无法统计，&#39;wall&#39;用于防火墙,&#39;stat&#39;用于监控，‘log4j’用于日志,&#39;config&#39;是指ConfigFilter
    spring.datasource.filters=wall,stat,config

    # 通过connectProperties属性来打开mergeSql功能；慢SQL记录,超过3秒就是慢sql
    spring.datasource.connectionProperties=druid.stat.mergeSql=true;druid.stat.slowSqlMillis=3000;config.decrypt=true

    # 合并多个DruidDataSource的监控数据,缺省多个DruidDataSource的监控数据是各自独立的，在Druid-0.2.17版本之后，支持配置公用监控数据
    spring.datasource.useGlobalDataSourceStat=true

    #druid登陆用户名
    spring.druid.loginUsername=lCzd9geWAuAuJtLhpaG/J+d28H8KiMFAWopxXkYpMNdUai6Xe/LsPqMQeg5MIrmvtMa+hzycdRhWs29ZUPU1IQ==

    #druid登录密码
    spring.druid.loginPassword=hf96/2MU+Q12fdb9oZN9ghub1OHmUBa8YuW7NJf8Pll/sawcaRVscHTpr4t5SB39+KbJn31Lqy76uEDvj+sgMw==</code></pre>
<h2 id="集成Mybatis"><a href="#集成Mybatis" class="headerlink" title="集成Mybatis"></a>集成Mybatis</h2><h3 id="MyBatisConfig"><a href="#MyBatisConfig" class="headerlink" title="MyBatisConfig"></a>MyBatisConfig</h3><pre><code class="java">    /**
     * Created by LiuFa on 2016/8/8.
     * cn.lfdevelopment.www.sys.mybatis
     * DevelopmentApp
     * DataSource 交由Druid自动根据配置创建
     */
    @Configuration
    @EnableTransactionManagement
    public class MyBatisConfig implements TransactionManagementConfigurer {

        @Autowired
        private DataSource dataSource;


        @Bean
        public SqlSessionFactory sqlSessionFactory() throws Exception {
            SqlSessionFactoryBean bean = new SqlSessionFactoryBean();
            bean.setDataSource(dataSource);
            bean.setTypeAliasesPackage(&quot;cn.lfdevelopment.www.app.**.pojo&quot;);
            //支持属性使用驼峰的命名,mapper配置不需要写字段与属性的配置，会自动映射。
            org.apache.ibatis.session.Configuration configuration = new org.apache.ibatis.session.Configuration();
            configuration.setMapUnderscoreToCamelCase(true);
            bean.setConfiguration(configuration);

            //分页插件
            PageHelper pageHelper = new PageHelper();
            Properties properties = new Properties();
            /* 3.3.0版本可用 - 分页参数合理化，默认false禁用
             启用合理化时，如果pageNum&lt;1会查询第一页，如果pageNum&gt;pages会查询最后一页
             禁用合理化时，如果pageNum&lt;1或pageNum&gt;pages会返回空数据
             在EXTjs里面配置与否无所谓，因为在前台传过来的分页数据已经进行合理化了 */
            properties.setProperty(&quot;reasonable&quot;, &quot;true&quot;);
            properties.setProperty(&quot;supportMethodsArguments&quot;, &quot;true&quot;);
            properties.setProperty(&quot;returnPageInfo&quot;, &quot;check&quot;);
           /* 3.5.0版本可用 - 为了支持startPage(Object params)方法
             增加了一个`params`参数来配置参数映射，用于从Map或ServletRequest中取值
             可以配置pageNum,pageSize,count,pageSizeZero,reasonable,orderBy,不配置映射的用默认值
             不理解该含义的前提下，不要随便复制该配置 --&gt;*/

    //        properties.setProperty(&quot;params&quot;, &quot;count=countSql&quot;);
            pageHelper.setProperties(properties);

            //添加插件
            bean.setPlugins(new Interceptor[]{pageHelper});

            //添加XML目录
            ResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
            try {
                bean.setMapperLocations(resolver.getResources(&quot;classpath*:mapperxml/**/*Mapper.xml&quot;));
                return bean.getObject();
            } catch (Exception e) {
                e.printStackTrace();
                throw new RuntimeException(e);
            }
        }

        @Bean
        public SqlSessionTemplate sqlSessionTemplate(SqlSessionFactory sqlSessionFactory) {
            return new SqlSessionTemplate(sqlSessionFactory);
        }

        @Bean
        @Override
        public PlatformTransactionManager annotationDrivenTransactionManager() {
            try {
                return new DataSourceTransactionManager(dataSource);
            } catch (Exception e) {
                e.printStackTrace();
                return null;
            }
        }
    }
</code></pre>
<h3 id="MyBatisMapperScannerConfig"><a href="#MyBatisMapperScannerConfig" class="headerlink" title="MyBatisMapperScannerConfig"></a>MyBatisMapperScannerConfig</h3><pre><code class="java">    /**
     * MyBatis扫描接口，使用的tk.mybatis.spring.mapper.MapperScannerConfigurer，如果你不使用通用Mapper，可以改为org.xxx...
     */
    @Configuration
    //由于MapperScannerConfigurer执行的比较早
    public class MyBatisMapperScannerConfig {

        @Bean
        public static MapperScannerConfigurer mapperScannerConfigurer() {
            MapperScannerConfigurer mapperScannerConfigurer = new MapperScannerConfigurer();
            mapperScannerConfigurer.setSqlSessionFactoryBeanName(&quot;sqlSessionFactory&quot;);
            mapperScannerConfigurer.setBasePackage(&quot;cn.lfdevelopment.www.app.**.mapper&quot;);
            Properties properties = new Properties();
            properties.setProperty(&quot;mappers&quot;, &quot;cn.lfdevelopment.www.sys.base.BaseMapper&quot;);
            properties.setProperty(&quot;notEmpty&quot;, &quot;false&quot;);
            properties.setProperty(&quot;IDENTITY&quot;, &quot;MYSQL&quot;);
            mapperScannerConfigurer.setProperties(properties);
            return mapperScannerConfigurer;
        }

    }</code></pre>
<h2 id="集成Redis"><a href="#集成Redis" class="headerlink" title="集成Redis"></a>集成Redis</h2><h3 id="RedisConfig"><a href="#RedisConfig" class="headerlink" title="RedisConfig"></a>RedisConfig</h3><pre><code class="java">
/**
 * Created by LiuFa on 2016/9/5.
 * cn.lfdevelopment.www.sys.redis
 * DevelopmentApp
 */
@Configuration
@EnableCaching
public class RedisConfig extends CachingConfigurerSupport {
    @Bean
    public KeyGenerator keyGenerator() {
        return (target, method, params) -&gt; {
            StringBuilder sb = new StringBuilder();
            sb.append(target.getClass().getName());
            sb.append(method.getName());
            for (Object obj : params) {
                sb.append(obj.toString());
            }
            return sb.toString();
        };
    }

    @Bean
    public CacheManager cacheManager(RedisTemplate redisTemplate) {
        return new RedisCacheManager(redisTemplate);
    }

    /**
     * StringRedisTemplate
     * @param factory
     * @return
     */
    @Bean
    public RedisTemplate&lt;String, String&gt; redisTemplate(RedisConnectionFactory factory) {
        StringRedisTemplate template = new StringRedisTemplate(factory);
        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer&lt;&gt;(Object.class);
        ObjectMapper om = new ObjectMapper();
        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);
        jackson2JsonRedisSerializer.setObjectMapper(om);
        template.setValueSerializer(jackson2JsonRedisSerializer);
        template.afterPropertiesSet();
        return template;
    }


    /**
     * redisTemplateForShiro
     * @param factory
     * @return
     */
    @Bean
    public RedisTemplate&lt;byte[], Object&gt; redisTemplateForShiro(RedisConnectionFactory factory) {
        RedisTemplate&lt;byte[], Object&gt; redisTemplateForShiro = new RedisTemplate&lt;&gt;();
        redisTemplateForShiro.setConnectionFactory(factory);
        return redisTemplateForShiro;
    }

}</code></pre>
<h2 id="集成Shiro"><a href="#集成Shiro" class="headerlink" title="集成Shiro"></a>集成Shiro</h2><h3 id="ShiroConfiguration"><a href="#ShiroConfiguration" class="headerlink" title="ShiroConfiguration"></a>ShiroConfiguration</h3><pre><code class="java">    /**
     * Created by LiuFa on 2016/9/13.
     * cn.lfdevelopment.www.sys.shiro
     * DevelopmentApp
     */
    @Configuration
    public class ShiroConfiguration {
        /**
         * FilterRegistrationBean
         * @return
         */
        @Autowired
        private RedisTemplate redisTemplate;

        @Bean
        public FilterRegistrationBean filterRegistrationBean() {
            FilterRegistrationBean filterRegistration = new FilterRegistrationBean();
            filterRegistration.setFilter(new DelegatingFilterProxy(&quot;shiroFilter&quot;));
            filterRegistration.addInitParameter(&quot;targetFilterLifecycle&quot;,&quot;true&quot;);
            filterRegistration.addUrlPatterns(&quot;/*&quot;);
            filterRegistration.addInitParameter(&quot;exclusions&quot;, &quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;);
    //        filterRegistration.setAsyncSupported(true);
            filterRegistration.setDispatcherTypes(DispatcherType.REQUEST);
            return filterRegistration;
        }

        /**
         * @see org.apache.shiro.spring.web.ShiroFilterFactoryBean
         * @return
         */
        @Bean(name = &quot;shiroFilter&quot;)
        public ShiroFilterFactoryBean shiroFilter(){
            ShiroFilterFactoryBean bean = new ShiroFilterFactoryBean();
            bean.setSecurityManager(securityManager());
            bean.setLoginUrl(&quot;/login&quot;);
            bean.setSuccessUrl(&quot;/main&quot;);
            //验证不具备权限后的转向页面
            bean.setUnauthorizedUrl(&quot;/main&quot;);

            Map&lt;String, Filter&gt; filters = new LinkedHashMap&lt;&gt;();
            filters.put(&quot;authc&quot;,shiroFormAuthenticationFilter());
            filters.put(&quot;session&quot;,sessionFilter());
            filters.put(&quot;rolesOr&quot;,rolesAuthorizationFilter());
            bean.setFilters(filters);

            Map&lt;String, String&gt; chains = new LinkedHashMap&lt;&gt;();
            chains.put(&quot;/favicon.ico&quot;,&quot;anon&quot;);
            chains.put(&quot;/&quot;,&quot;anon&quot;);
            chains.put(&quot;/index&quot;,&quot;anon&quot;);
            chains.put(&quot;/blog&quot;,&quot;anon&quot;);
            chains.put(&quot;/blog/**&quot;,&quot;anon&quot;);
            chains.put(&quot;/weixin&quot;,&quot;anon&quot;);
            chains.put(&quot;/weixin/**&quot;,&quot;anon&quot;);
            chains.put(&quot;/static/**&quot;, &quot;anon&quot;);
            chains.put(&quot;/getGifCode&quot;,&quot;anon&quot;);
            chains.put(&quot;/404&quot;, &quot;anon&quot;);
            chains.put(&quot;/druid/**&quot;,&quot;anon&quot;);
            chains.put(&quot;/logout&quot;, &quot;logout&quot;);

            chains.put(&quot;/login&quot;, &quot;authc&quot;);
            chains.put(&quot;/main&quot;,&quot;authc&quot;);
            chains.put(&quot;/**&quot;, &quot;session,user&quot;);
            bean.setFilterChainDefinitionMap(chains);
            return bean;
        }


        /**
         * @see org.apache.shiro.mgt.SecurityManager
         * @return
         */
        @Bean(name=&quot;securityManager&quot;)
        public DefaultWebSecurityManager securityManager() {
            DefaultWebSecurityManager manager = new DefaultWebSecurityManager();
            manager.setRealm(userRealm());
            manager.setCacheManager(redisCacheManager());
            manager.setSessionManager(defaultWebSessionManager());
            return manager;
        }

        /**
         * @see DefaultWebSessionManager
         * @return
         */
        @Bean(name=&quot;sessionManager&quot;)
        public DefaultWebSessionManager defaultWebSessionManager() {
            DefaultWebSessionManager sessionManager = new DefaultWebSessionManager();
            sessionManager.setCacheManager(redisCacheManager());
            sessionManager.setGlobalSessionTimeout(1800000);
            sessionManager.setDeleteInvalidSessions(true);
            sessionManager.setSessionValidationSchedulerEnabled(true);
            sessionManager.setSessionValidationInterval(600000);
            sessionManager.setSessionIdUrlRewritingEnabled(false);
            return sessionManager;
        }


        /**
         * @return
         */
        @Bean
        @DependsOn(value={&quot;lifecycleBeanPostProcessor&quot;, &quot;shrioRedisCacheManager&quot;})
        public AuthorizingRealm userRealm() {
            AuthorizingRealm userRealm = new AuthorizingRealm();
            userRealm.setCacheManager(redisCacheManager());
            userRealm.setCachingEnabled(true);
            userRealm.setAuthenticationCachingEnabled(true);
            userRealm.setAuthorizationCachingEnabled(true);
            return userRealm;
        }


        @Bean(name=&quot;shrioRedisCacheManager&quot;)
        @DependsOn(value=&quot;redisTemplate&quot;)
        public ShrioRedisCacheManager redisCacheManager() {
            ShrioRedisCacheManager cacheManager = new ShrioRedisCacheManager(redisTemplate);
            return cacheManager;
        }

        @Bean
        public LifecycleBeanPostProcessor lifecycleBeanPostProcessor() {
            return new LifecycleBeanPostProcessor();
        }

        @Bean(name = &quot;authcFilter&quot;)
        public FormAuthenticationFilter shiroFormAuthenticationFilter(){
            return new AuthcFilter();
        }

        @Bean
        public SessionFilter sessionFilter(){
            return new SessionFilter();
        }


        @Bean(name = &quot;rolesOrFilter&quot;)
        public RolesAuthorizationFilter rolesAuthorizationFilter(){
            return new RolesAuthorizationFilter() {
                @Override
                public boolean isAccessAllowed(ServletRequest request,
                                               ServletResponse response, Object mappedValue) throws IOException {
                    Subject subject = getSubject(request, response);
                    String[] rolesArray = (String[]) mappedValue;

                    if ((rolesArray == null) || (rolesArray.length == 0)) {
                        return true;
                    }
                    for (String aRolesArray : rolesArray) {
                        if (subject.hasRole(aRolesArray)) {
                            //用户只要拥有任何一个角色则验证通过
                            return true;
                        }
                    }
                    return false;
                }
            };
        }
    }</code></pre>
<h3 id="ShiroRedisCache"><a href="#ShiroRedisCache" class="headerlink" title="ShiroRedisCache"></a>ShiroRedisCache</h3><pre><code class="java">    /**
     * Created by LiuFa on 2016/9/13.
     * cn.lfdevelopment.www.sys.shiro
     * DevelopmentApp
     */
    public class ShrioRedisCache&lt;K, V&gt; implements Cache&lt;K, V&gt; {
        private org.slf4j.Logger log = LoggerFactory.getLogger(getClass());
        @Autowired
        private RedisTemplate&lt;byte[], V&gt; redisTemplate;
        private String prefix = &quot;shiro_redis:&quot;;

        public ShrioRedisCache(RedisTemplate&lt;byte[], V&gt; redisTemplate) {
            this.redisTemplate = redisTemplate;
        }

        public ShrioRedisCache(RedisTemplate&lt;byte[], V&gt; redisTemplate, String prefix) {
            this(redisTemplate);
            this.prefix = prefix;
        }

        @Override
        public V get(K key) throws CacheException {
            if(log.isDebugEnabled()) {
                log.debug(&quot;Key: {}&quot;, key);
            }
            if(key == null) {
                return null;
            }

            byte[] bkey = getByteKey(key);
            return redisTemplate.opsForValue().get(bkey);
        }

        @Override
        public V put(K key, V value) throws CacheException {
            if(log.isDebugEnabled()) {
                log.debug(&quot;Key: {}, value: {}&quot;, key, value);
            }

            if(key == null || value == null) {
                return null;
            }

            byte[] bkey = getByteKey(key);
            redisTemplate.opsForValue().set(bkey, value);
            return value;
        }

        @Override
        public V remove(K key) throws CacheException {
            if(log.isDebugEnabled()) {
                log.debug(&quot;Key: {}&quot;, key);
            }

            if(key == null) {
                return null;
            }

            byte[] bkey = getByteKey(key);
            ValueOperations&lt;byte[], V&gt; vo = redisTemplate.opsForValue();
            V value = vo.get(bkey);
            redisTemplate.delete(bkey);
            return value;
        }

        @Override
        public void clear() throws CacheException {
            redisTemplate.getConnectionFactory().getConnection().flushDb();
        }

        @Override
        public int size() {
            Long len = redisTemplate.getConnectionFactory().getConnection().dbSize();
            return len.intValue();
        }

        @SuppressWarnings(&quot;unchecked&quot;)
        @Override
        public Set&lt;K&gt; keys() {
            byte[] bkey = (prefix+&quot;*&quot;).getBytes();
            Set&lt;byte[]&gt; set = redisTemplate.keys(bkey);
            Set&lt;K&gt; result = new HashSet&lt;&gt;();

            if(CollectionUtils.isEmpty(set)) {
                return Collections.emptySet();
            }

            for(byte[] key: set) {
                result.add((K)key);
            }
            return result;
        }

        @Override
        public Collection&lt;V&gt; values() {
            Set&lt;K&gt; keys = keys();
            List&lt;V&gt; values = new ArrayList&lt;&gt;(keys.size());
            for(K k: keys) {
                byte[] bkey = getByteKey(k);
                values.add(redisTemplate.opsForValue().get(bkey));
            }
            return values;
        }

        private byte[] getByteKey(K key){
            if(key instanceof String){
                String preKey = this.prefix + key;
                return preKey.getBytes();
            }else{
                return SerializeUtils.serialize(key);
            }
        }

        public String getPrefix() {
            return prefix;
        }

        public void setPrefix(String prefix) {
            this.prefix = prefix;
        }
    }</code></pre>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><ul>
<li>本文暂未完结，后续将持续集成更多第三方框架，或接着更新，或另起新篇</li>
<li>详细代码内容可在GitHub上follow</li>
</ul>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls"
                data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
            <ul id="audio-list" style="display:none">
                
                
                <li title='0' data-url='/statics/chengdu.mp3'></li>
                
                    
            </ul>
            
            
            
    <div id='gitalk-container' class="comment link"
        data-ae='true'
        data-ci='d9218a69d0b64a6a69b4'
        data-cs='1ff13ada2c9062d823689a5fef4bb431f257916b'
        data-r='blog'
        data-o='JoyLau'
        data-a='JoyLau'
        data-d=''
    >留言</div>


            
            
        </div>
        <div class="sidebar">
            <div class="box animated fadeInRight">
                <div class="subbox">
                    <img src="http://image.joylau.cn/blog/JoyLau.jpg" height=300 width=300></img>
                    <p>JoyLau</p>
                    <span>整理一些在项目中用到的小知识或者技术点做一个总结及叙述，希望通过这些记录，能够将自己的学习成果归纳出来，对这些技术进行备忘，以便日后查询</span>
                    <dl>
                        <dd><a href="mailto:2587038142.liu@gmail.com" target="_blank"><span
                                        class=" iconfont icon-email-fill"></span></a></dd>
                        <dd><a href="https://github.com/JoyLau" target="_blank"><span
                                    class=" iconfont icon-github"></span></a></dd>
                        <dd><a href="https://twitter.com/FailingLiu" target="_blank"><span
                                    class=" iconfont icon-twitter"></span></a></dd>
                    </dl>
                </div>
                <ul>
                    <li><a href="/">222 <p>文章</p></a></li>
                    <li><a href="/categories">49 <p>分类</p></a></li>
                    <li><a href="/tags">106 <p>标签</p></a></li>
                </ul>
            </div>
            
            
            
            <div class="box sticky animated fadeInRight faster">
                <div id="toc" class="subbox">
                    <h4>目录</h4>
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot文章推荐"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot文章推荐</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot项目实战"><span class="toc-number">2.</span> <span class="toc-text">SpringBoot项目实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#集成Druid"><span class="toc-number">3.</span> <span class="toc-text">集成Druid</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DruidConfig"><span class="toc-number">3.1.</span> <span class="toc-text">DruidConfig:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DruidStatViewConfig"><span class="toc-number">3.2.</span> <span class="toc-text">DruidStatViewConfig:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#application-dev"><span class="toc-number">3.3.</span> <span class="toc-text">application-dev:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#集成Mybatis"><span class="toc-number">4.</span> <span class="toc-text">集成Mybatis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatisConfig"><span class="toc-number">4.1.</span> <span class="toc-text">MyBatisConfig</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatisMapperScannerConfig"><span class="toc-number">4.2.</span> <span class="toc-text">MyBatisMapperScannerConfig</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#集成Redis"><span class="toc-number">5.</span> <span class="toc-text">集成Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RedisConfig"><span class="toc-number">5.1.</span> <span class="toc-text">RedisConfig</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#集成Shiro"><span class="toc-number">6.</span> <span class="toc-text">集成Shiro</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ShiroConfiguration"><span class="toc-number">6.1.</span> <span class="toc-text">ShiroConfiguration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ShiroRedisCache"><span class="toc-number">6.2.</span> <span class="toc-text">ShiroRedisCache</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最后"><span class="toc-number">7.</span> <span class="toc-text">最后</span></a></li></ol>
                </div>
            </div>
            
            
        </div>
    </div>
</div>

    </div>
</div>
    <div id="back-to-top" class="animated fadeIn faster">
        <div class="flow"></div>
        <span class="percentage animated fadeIn faster">0%</span>
        <span class="iconfont icon-top02 animated fadeIn faster"></span>
    </div>
</body>
<footer>
    <p class="copyright">
        <span title="本站访问量"><span class=" iconfont icon-yonghu"> </span> <span id="busuanzi_value_site_pv" class="gradient-text"></span></span> | <span title="本页阅读量"><span class="iconfont icon-eye"> </span> <span id="busuanzi_value_page_pv" class="gradient-text"></span></span>
    </p>
    <p class="copyright" id="copyright">
        &copy; 2017 - 2021
        <span class="gradient-text">
            JoyLau
        </span>.
        Powered by
        <span class="gradient-text">
            Hexo
        </span>
        Theme
        <span class="gradient-text">
            Obsidian
        </span>
    </p>
</footer>

    
<link rel="stylesheet" href="/css/gitalk/1.5.0/gitalk.min.css">

    
<script src="/js/gitalk/1.5.0/gitalk.min.js"></script>





<script src="//cdn.bootcss.com/codemirror/5.53.2/codemirror.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/javascript/javascript.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/css/css.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/xml/xml.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/htmlmixed/htmlmixed.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/clike/clike.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/php/php.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/shell/shell.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/python/python.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/yaml/yaml.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/groovy/groovy.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/sql/sql.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/jsx/jsx.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/powershell/powershell.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/nginx/nginx.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/http/http.min.js"></script>



<script src="/js/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/obsidian.js"></script>
<script src="/js/jquery.truncate.js"></script>
<script src="/js/search.js"></script>


<script src="/js/typed.js/2.0.10/typed.min.js"></script>


<script src="/js/blueimp-md5/2.12.0/js/md5.min.js"></script>


<script src="/js/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>




    
<script src="/js/busuanzi.js"></script>

    <script>
        $(document).ready(function () {
            if ($('span[id^="busuanzi_"]').length) {
                initialBusuanzi();
            }
        });
    </script>



<link rel="stylesheet" href="/css/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="/css/photoswipe/4.1.3/default-skin/default-skin.min.css">


<script src="/js/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="/js/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>







<script>
    function initialTyped () {
        var typedTextEl = $('.typed-text');
        if (typedTextEl && typedTextEl.length > 0) {
            var typed = new Typed('.typed-text', {
                strings: ["Think like an artist, develop like an artisan", "艺术家思维去思考问题，工匠创造精神去开发"],
                typeSpeed: 90,
                loop: true,
                loopCount: Infinity,
                backSpeed: 20,
            });
        }
    }

    if ($('.article-header') && $('.article-header').length) {
        $(document).ready(function () {
            initialTyped();
        });
    }
</script>



  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?691c26474b1733df80dca4dfa7ba5536";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


</html>
