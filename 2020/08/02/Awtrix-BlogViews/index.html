
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Awtrix App --- 开发一款显示个人博客访问人数的 App - JoyLau&#39;s Blog | JoyLau</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="JoyLau,Blog,JoyLau&#39;s Blog,"> 
    <meta name="description" content="JoyLau的技术学习与思考,JoyLau的个人博客,刘法的技术学习与思考,刘法的个人博客。,
说明Awtrix App 开发入门之开发一款显示个人博客访问人数的 App

具备 Awtrix 硬件设备
博客的计数工具是不蒜子

环境准备
JDK 8 的环境
开发工具： B4J

效果图
开,"> 
    <meta name="author" content="JoyLau"> 
    <link rel="alternative" href="atom.xml" title="JoyLau&#39;s Blog | JoyLau" type="application/atom+xml"> 
    <link rel="icon" href="http://image.joylau.cn/favicon.ico"> 
    <meta name="baidu-site-verification" content="YKshmF02SZ" />
    
<link rel="stylesheet" href="/css/font.css">

    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1429596_nzgqgvnmkjb.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_1792772_esp1kuicf2e.css">

    
<link rel="stylesheet" href="/css/animate.css/3.7.2/animate.min.css">

    
<link rel="stylesheet" href="/css/ajax/libs/social-share.js/1.0.16/css/share.min.css">

    
<link rel="stylesheet" href="/css/codemirror/5.53.2/codemirror.min.css">

    
<link rel="stylesheet" href="/css/codemirror/5.53.2/theme/dracula.css">

    
<link rel="stylesheet" href="/css/obsidian.css">

    
<link rel="stylesheet" href="/css/ball-atom.min.css">

<meta name="generator" content="Hexo 4.2.1"></head>


<body class="loading">
    <div class="loader">
        <div class="la-ball-atom la-2x">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <span id="config-title" style="display:none">JoyLau&#39;s Blog | JoyLau</span>
    <div id="loader"></div>
    <div id="single">
    <div class="scrollbar gradient-bg-rev"></div>
<div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <div class="navigation animated fadeIn fast delay-1s">
        <img id="home-icon" style="border-radius:50%" class="icon-home" src="http://image.joylau.cn/blog/JoyLau.jpg" alt="" data-url="http://blog.joylau.cn">
        <div id="play-icon" title="Play/Pause" class="iconfont icon-play"></div>
        <h3 class="subtitle">Awtrix App --- 开发一款显示个人博客访问人数的 App</h3>
        <div class="social">
            <!--        <div class="like-icon">-->
            <!--            <a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
            <!--        </div>-->
            <div>
                <div class="share">
                    
                        <a href="javascript:;" class="iconfont icon-share1"></a>
                        <div class="share-component-cc" data-disabled="facebook,douban,linkedin,diandian,tencent,google"></div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="section">
        <div class=article-header-wrapper>
    <div class="article-header">
        <div class="article-cover animated fadeIn" style="
            animation-delay: 600ms;
            animation-duration: 1.2s;
            background-image: 
                radial-gradient(ellipse closest-side, rgba(0, 0, 0, 0.65), #100e17),
                url(//image.joylau.cn/blog/Awtrix-preview-png.png?0.10453329166956848) ">
        </div>
        <div class="else">
            <p class="animated fadeInDown">
                
                <a href="/categories/Awtrix"><b>「
                    </b>AWTRIX<b> 」</b></a>
                
                八月 02, 2020
            </p>
            <h3 class="post-title animated fadeInDown"><a href="/2020/08/02/Awtrix-BlogViews/" title="Awtrix App --- 开发一款显示个人博客访问人数的 App" class="">Awtrix App --- 开发一款显示个人博客访问人数的 App</a>
            </h3>
            
            <p class="post-count animated fadeInDown">
                
                <span>
                    <b class="iconfont icon-text2"></b> <i>文章字数</i>
                    45k
                </span>
                
                
                <span>
                    <b class="iconfont icon-timer__s"></b> <i>阅读约需</i>
                    41 mins.
                </span>
                
                
                
                <span id="busuanzi_container_page_pv">
                    <b class="iconfont icon-read"></b> <i>阅读次数</i>
                    <span id="busuanzi_value_page_pv_copy"></span>
                </span>
                
            </p>
            
            
            <ul class="animated fadeInDown post-tags-list" itemprop="keywords"><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/Awtrix/" rel="tag">Awtrix</a></li></ul>
            
        </div>
    </div>
</div>

<div class="screen-gradient-after">
    <div class="screen-gradient-content">
        <div class="screen-gradient-content-inside">
            <div class="bold-underline-links screen-gradient-sponsor">
                <p>
                    <span class="animated fadeIn delay-1s"></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="article">
    <div class='main'>
        <div class="content markdown animated fadeIn">
            <a id="more"></a>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>Awtrix App 开发入门之开发一款显示个人博客访问人数的 App</p>
<ol>
<li>具备 Awtrix 硬件设备</li>
<li>博客的计数工具是<strong>不蒜子</strong></li>
</ol>
<h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><ol>
<li>JDK 8 的环境</li>
<li>开发工具： <a href="https://www.b4x.com/b4j.html" target="_blank" rel="noopener">B4J</a></li>
</ol>
<h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h3><p><img src="http://image.joylau.cn/blog/Awtrix-preview-gif.gif" alt="gif"><br><img src="http://image.joylau.cn/blog/Awtrix-web-app.png" alt="app"><br><img src="http://image.joylau.cn/blog/Awtrix-web-config.png" alt="config"></p>
<h3 id="开发准备"><a href="#开发准备" class="headerlink" title="开发准备"></a>开发准备</h3><ol>
<li>模板文件</li>
</ol>
<p>AWTRIX.bas： 这个文件的内容不需要改动直接复制即可</p>
<pre><code class="text">    B4J=true
    Group=Default Group
    ModulesStructureVersion=1
    Type=Class
    Version=7.31
    @EndOfDesignText@
    &#39;This Class takes control of the Interface to AWTRIX, the Icon Renderer
    &#39;and some useful functions to make the development more easier.
    &#39;Usually you dont need to modify this Class!

    #Event: Started
    #Event: controllerButton(button as int,dir as boolean)
    #Event: controllerAxis(axis as int, dir as float)
    #Event: Exited
    #Event: iconRequest
    #Event: settingsChanged
    #Event: startDownload(jobNr As Int) As String
    #Event: evalJobResponse(Resp As JobResponse)


    private Sub Class_Globals
        Private Appduration As Int
        Private mscrollposition As Int
        Private show As Boolean = True
        Private forceDown As Boolean
        Private LockApp As Boolean = False
        Private Icon As List
        Private appName As String
        Private AppVersion As String
        Private TickInterval As Int
        Private NeedDownloads As Int = 0
        Private UpdateInterval As Int = 0
        Private AppDescription As String
        Private AppAuthor As String
        Private SetupInfos As String
        Private MatrixInfo As Map
        Private appSettings As Map = CreateMap()
        Private ServerVersion As String
        Private DisplayTime As Int
        Private MatrixWidth As Int = 32
        Private MatrixHeight As Int = 8
        Private DownloadHeader As Map
        Private pluginversion As Int = 1
        Private Tag As List = Array As String()
        Private playdescription As String
        Private Cover As Int
        Private Game As Boolean
        Private startTimestamp As Long
        Private icoMap As Map
        Private RenderedIcons As Map
        Private animCounter As Map
        Private iconList As List&#39;ignore
        Private timermap As Map
        Private set As Map &#39;ignore
        Private Target As Object
        Private commandList As List
        Private colorCounter As Int
        Private startTime As String =&quot;0&quot;
        Private endtime As String = &quot;0&quot;
        Private CharMap As Map
        Private TextBuffer As String
        Private TextLength As Int
        Private UppercaseLetters As Boolean
        Private SystemColor() As Int
        Private event As String
        Private Enabled As Boolean = True
        Private noIcon() As Short = Array As Short(0, 0, 0, 63488, 63488, 0, 0, 0, 0, 0, 63488, 0, 0, 63488, 0, 0, 0, 0, 0, 0, 0, 63488, 0, 0, 0, 0, 0, 0, 63488, 0, 0, 0, 0, 0, 0, 63488, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 63488, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
        Private isRunning As Boolean
        Private Menu As Map
        Private MenuList As List
        Private bc As B4XSerializator
        Private noIconMessage As Boolean
        Private verboseLog As Boolean
        Private finishApp As Boolean
        Type JobResponse (jobNr As Int,Success As Boolean,ResponseString As String,Stream As InputStream)
        Private httpMap As Map
        Private OAuthToken As String
        Private OAuth As Boolean
        Private oauthmap As Map
        Private mContentType As String

        Private poll As Map = CreateMap(&quot;enable&quot;:False,&quot;sub&quot;:&quot;&quot;)
        Private mHidden As Boolean
    End Sub

    &#39;Initializes the Helperclass.
    Public Sub Initialize(class As Object, Eventname As String)

        oauthmap.Initialize
        Tag.Initialize
        httpMap.Initialize
        DownloadHeader.Initialize
        event=Eventname
        iconList.Initialize
        Icon.Initialize
        commandList.Initialize
        RenderedIcons.Initialize
        icoMap.Initialize
        animCounter.Initialize
        timermap.Initialize
        set.Initialize
        Menu.Initialize
        MatrixInfo.Initialize
        MenuList.Initialize
        Target=class
    End Sub

    &#39;Checks if the app should shown
    Private Sub timesComparative  As Boolean
        Try
            If startTime = endtime Then Return True
            Dim startT() As String=Regex.Split(&quot;:&quot;,startTime)
            Dim EndT() As String=Regex.Split(&quot;:&quot;,endtime)
            Dim hour As Int=DateTime.GetHour(DateTime.Now)
            Dim minute As Int=DateTime.GetMinute(DateTime.Now)
            Dim second As Int=DateTime.GetSecond(DateTime.Now)
            Dim now, start, stop As Int
            now = ((hour * 3600) + (minute * 60) + second)
            start = (startT(0) * 3600) + (startT(1) * 60)
            stop = ( EndT(0)* 3600) + (EndT(1) * 60)
            If (start &lt; stop) Then
                Return (now &gt;= start And now &lt;= stop )
            Else
                Return (now &gt;= start Or now &lt;= stop)
            End If
        Catch
            Log(&quot;Got Error from &quot; &amp; appName)
            Log(&quot;Error in TimesComparative:&quot;)
            Log(LastException)
            Return True
        End Try
    End Sub

    #Region IconRenderer
    Private Sub startIconRenderer
        isRunning=True
        FirstTick
        For Each k As Timer In timermap.Keys
            k.Enabled=True
            Sleep(1)
        Next
    End Sub

    Private Sub stopIconRenderer
        isRunning=False
        For Each k As Timer In timermap.Keys
            k.Enabled=False
            Sleep(1)
        Next
    End Sub

    Private Sub FirstTick
        For Each IconID As Int In icoMap.Keys
            Try
                If icoMap.ContainsKey(IconID) Then
                    Dim ico As List=icoMap.get(IconID)
                    Dim parse As JSONParser
                    If animCounter.Get(IconID)&gt;ico.Size-1 Then animCounter.put(IconID,0)
                    parse.Initialize(ico.Get(animCounter.Get(IconID)))
                    Dim bmproot As List = parse.NextArray
                    Dim bmp(bmproot.Size) As Short
                    For i=0 To bmproot.Size-1
                        bmp(i)=bmproot.Get(i)
                    Next
                    RenderedIcons.Put(IconID,bmp)
                    animCounter.put(IconID,animCounter.Get(IconID)+1)
                Else
                    Log(&quot;IconID&quot; &amp; IconID  &amp; &quot;doesnt exists&quot;)
                End If
            Catch
                Log(&quot;Got Error from &quot; &amp; appName)
                Log(&quot;Error in IconPreloader:&quot;)
                Log(&quot;IconID:&quot; &amp; IconID)
                Log(LastException)
            End Try
        Next
    End Sub

    Private Sub Timer_Tick
        Try
            Dim iconid As Int=timermap.Get(Sender)
            If icoMap.ContainsKey(iconid) Then
                Dim ico As List= icoMap.get(iconid)
                Dim parse As JSONParser
                If animCounter.Get(iconid)&gt;ico.Size-1 Then animCounter.put(iconid,0)
                parse.Initialize(ico.Get(animCounter.Get(iconid)))
                Dim bmproot As List = parse.NextArray
                Dim bpm(bmproot.Size) As Short
                For i=0 To bmproot.Size-1
                    bpm(i)=bmproot.Get(i)
                Next
                RenderedIcons.Put(iconid,bpm)
                animCounter.put(iconid,animCounter.Get(iconid)+1)
            Else
                Logger(&quot;IconID&quot; &amp; iconid  &amp; &quot;doesnt exists&quot;)
            End If
        Catch
            Log(&quot;Got Error from &quot; &amp; appName)
            Log(&quot;Error in IconRenderer:&quot;)
            Log(LastException)
            stopIconRenderer
        End Try
    End Sub

    Private Sub addToIconRenderer(iconMap As Map)
        Try
            If iconMap.Size=0 Then Return
            Dim runMarker As Boolean
            If isRunning Then
                stopIconRenderer
                runMarker=True
            End If
            timermap.Clear
            icoMap.Clear
            animCounter.Clear
            RenderedIcons.Clear
            For Each ico As Int In iconMap.Keys
                Dim ico1 As Map = iconMap.get(ico)
                If ico1.ContainsKey(&quot;tick&quot;) Then
                    icoMap.Put(ico,ico1.Get(&quot;data&quot;))
                    animCounter.Put(ico,0)
                    Dim timer As Timer
                    timer.Initialize(&quot;Timer&quot;,ico1.Get(&quot;tick&quot;))
                    Dim icoExists As Boolean=False
                    For Each timerico As Int In timermap.Values
                        If timerico=ico Then icoExists=True
                    Next
                    If Not(icoExists) Then timermap.Put(timer,ico)
                Else
                    RenderedIcons.Put(ico,ico1.Get(&quot;data&quot;))
                End If
            Next
            If runMarker Then
                startIconRenderer
            End If
        Catch
            Log(&quot;Got Error from &quot; &amp; appName)
            Log(&quot;Error in IconAdder:&quot;)
            Log(LastException)
        End Try
    End Sub

    &#39;returns the rendered Icon
    Public Sub getIcon(ID As Int) As Short()
        If RenderedIcons.ContainsKey(ID) Then
            Return RenderedIcons.Get(ID)
        Else
            If noIconMessage = False Then
                Logger(&quot;Icon &quot; &amp; ID &amp; &quot; not found&quot;)
                noIconMessage=True
            End If

            Return noIcon
        End If
    End Sub
    #End Region

    &#39;This is the interface between AWTRIX and the App
    Public Sub interface(function As String, Params As Map) As Object
        Select Case function
            Case &quot;start&quot;
                mscrollposition=MatrixWidth
                If SubExists(Target,event&amp;&quot;_Started&quot;) Then
                    CallSub(Target,event&amp;&quot;_Started&quot;)
                End If
                Try
                    Appduration = Params.Get(&quot;AppDuration&quot;)
                    If DisplayTime&gt;0 Then
                        Appduration=DisplayTime
                    End If
                    verboseLog =Params.Get(&quot;verboseLog&quot;)
                    ServerVersion =    Params.Get(&quot;ServerVersion&quot;)
                    MatrixWidth = Params.Get(&quot;MatrixWidth&quot;)
                    MatrixHeight = Params.Get(&quot;MatrixHeight&quot;)
                    UppercaseLetters = Params.Get(&quot;UppercaseLetters&quot;)
                    CharMap = Params.Get(&quot;CharMap&quot;)
                    SystemColor = Params.Get(&quot;SystemColor&quot;)
                    MatrixInfo=Params.Get(&quot;MatrixInfo&quot;)
                    set.Put(&quot;interval&quot;,TickInterval)
                    set.Put(&quot;needDownload&quot;,NeedDownloads)
                    set.Put(&quot;DisplayTime&quot;, DisplayTime)
                    set.Put(&quot;forceDownload&quot;, forceDown)
                Catch
                    Log(&quot;Got Error from &quot; &amp; appName)
                    Log(&quot;Error in start procedure&quot;)
                    Log(LastException)
                End Try
                startTimestamp=DateTime.now
                noIconMessage=False
                If show Then
                    set.Put(&quot;show&quot;,timesComparative)
                Else
                    set.Put(&quot;show&quot;,show)
                End If

                set.Put(&quot;isGame&quot;,Game)
                set.Put(&quot;hold&quot;,LockApp)
                set.Put(&quot;iconList&quot;,Icon)
                Return set
            Case &quot;downloadCount&quot;
                Return NeedDownloads
            Case &quot;startDownload&quot;
                httpMap.Initialize
                DownloadHeader.Initialize
                mContentType=&quot;&quot;
                If SubExists(Target,event&amp;&quot;_startDownload&quot;) Then
                    CallSub2(Target,event&amp;&quot;_startDownload&quot;,Params.Get(&quot;jobNr&quot;))
                End If
                If DownloadHeader.Size&gt;0 Then
                    httpMap.Put(&quot;Header&quot;,DownloadHeader)
                End If
                If mContentType.Length&gt;0 Then
                    httpMap.Put(&quot;ContentType&quot;,mContentType)
                End If
                Return httpMap
            Case &quot;httpResponse&quot;
                Dim res As JobResponse
                res.Initialize
                res.jobNr=Params.Get(&quot;jobNr&quot;)
                res.Success=Params.Get(&quot;success&quot;)
                res.ResponseString=Params.Get(&quot;response&quot;)
                res.Stream=Params.Get(&quot;InputStream&quot;)
                If SubExists(Target,event&amp;&quot;_evalJobResponse&quot;) Then
                    CallSub2(Target,event&amp;&quot;_evalJobResponse&quot;,res)
                End If
                Return True
            Case &quot;running&quot;
                startIconRenderer
            Case &quot;tick&quot;
                commandList.Clear
                If finishApp Then
                    finishApp=False
                    commandList.Add(CreateMap(&quot;type&quot;:&quot;finish&quot;))
                Else
                    If SubExists(Target,event&amp;&quot;_genFrame&quot;) Then
                        CallSub(Target,event&amp;&quot;_genFrame&quot;)&#39;ignore
                    End If
                End If

                Return commandList
            Case &quot;infos&quot;
                Dim infos As Map
                infos.Initialize
                Dim isconfigured As Boolean = True
                If File.Exists(File.Combine(File.DirApp,&quot;Apps&quot;),appName&amp;&quot;.ax&quot;) Then
                    Dim m As Map = bc.ConvertBytesToObject(File.ReadBytes(File.Combine(File.DirApp,&quot;Apps&quot;),appName&amp;&quot;.ax&quot;))
                    For Each v As Object In m.Values
                        If v=&quot;null&quot; Or v=&quot;&quot; Then
                            isconfigured=False
                        End If
                    Next
                    If OAuth And OAuthToken.Length=0 Then isconfigured=False
                End If
                infos.Put(&quot;isconfigured&quot;,isconfigured)
                infos.Put(&quot;AppVersion&quot;,AppVersion)
                infos.Put(&quot;tags&quot;,Tag)
                infos.Put(&quot;poll&quot;,poll)
                infos.Put(&quot;oauth&quot;,OAuth)
                infos.Put(&quot;oauthmap&quot;,oauthmap)
                infos.Put(&quot;isGame&quot;,Game)
                infos.Put(&quot;CoverIcon&quot;,Cover)
                infos.Put(&quot;pluginversion&quot;,pluginversion)
                infos.Put(&quot;author&quot;,AppAuthor)
                infos.Put(&quot;howToPLay&quot;,playdescription)
                infos.Put(&quot;description&quot;,AppDescription)
                infos.Put(&quot;setupInfos&quot;,SetupInfos)
                infos.Put(&quot;hidden&quot;,mHidden)
                Return infos
            Case &quot;setSettings&quot;
                makeSettings
                Return True
            Case &quot;getUpdateInterval&quot;
                Return UpdateInterval
            Case &quot;setEnabled&quot;
                saveSingleSetting(&quot;Enabled&quot;,Params.Get(&quot;Enabled&quot;))
                makeSettings
            Case &quot;getEnable&quot;
                Return Enabled
            Case &quot;stop&quot;
                If Game Then
                    finishApp=False
                    show=False
                End If
                stopIconRenderer
                If SubExists(Target,event&amp;&quot;_Exited&quot;) Then
                    CallSub(Target,event&amp;&quot;_Exited&quot;)
                End If
            Case &quot;getIcon&quot;
                If SubExists(Target,event&amp;&quot;_iconRequest&quot;) Then
                    CallSub(Target,event&amp;&quot;_iconRequest&quot;)
                End If
                Return CreateMap(&quot;iconList&quot;:Icon)
            Case &quot;iconList&quot;
                addToIconRenderer(Params)
            Case &quot;externalCommand&quot;
                externalCommand(Params)
            Case &quot;controller&quot;
                Control(Params)
            Case &quot;getMenu&quot;
                Menu.Initialize
                Menu.Put(&quot;Version&quot;,&quot;1.6&quot;)
                Menu.Put(&quot;Theme&quot;,&quot;Light Theme&quot;)
                Menu.Put(&quot;Items&quot;,MenuList)
                Return Menu
            Case &quot;setToken&quot;
                OAuthToken=Params.Get(&quot;token&quot;)
            Case &quot;isReady&quot;
                If SubExists(Target,event&amp;&quot;_isReady&quot;) Then
                    Return CallSub(Target,event&amp;&quot;_isReady&quot;)
                Else
                    Return True
                End If

            Case &quot;shouldShow&quot;
                Return show
            Case &quot;poll&quot;
                Dim s As String=Params.Get(&quot;sub&quot;)
                If SubExists(Target,event &amp; &quot;_&quot; &amp; s) Then
                    CallSub(Target,event &amp; &quot;_&quot; &amp; s)
                End If
        End Select
        Return True
    End Sub

    &#39;This function calculates the ammount of pixels wich a text needs
    Public Sub calcTextLength(text As String) As Int
        If UppercaseLetters Then text = text.ToUpperCase
        If TextBuffer&lt;&gt;text Then
            Dim Length As Int
            For i=0 To text.Length-1
                If CharMap.ContainsKey(Asc(text.CharAt(i))) Then
                    Length=Length+(CharMap.Get(Asc(text.CharAt(i))))
                Else
                    Length=Length+4
                End If
            Next
            TextBuffer=text
            TextLength=Length
            Return Length
        End If
        Return TextLength
    End Sub

    &#39;This Helper automaticly display a text in a default app style
    &#39;If the text is longer than the Matrixwitdh it will scroll the text
    &#39;otherwise it will center the text. Call drawText to handle it manually.
    &#39;
    &#39;Text - the text to be displayed
    &#39;IconOffset - wether you need an offset if you place an icon on the left side.
    &#39;yPostition
    &#39;Color - custom text color. Pass Null to use the Global textcolor (recommended).
    &#39;
    &#39;&lt;code&gt;App.genText(&quot;Hello World&quot;,True,Array as int(255,0,0),false)&lt;/code&gt;
    Public Sub genText(Text As String,IconOffset As Boolean,yPostition As Int,Color() As Int,callFinish As Boolean)
        If Text.Length=0 Then
            finish
            Return
        End If
        calcTextLength(Text)
        Dim offset As Int
        If IconOffset Then offset = 24 Else offset = 32
        If TextLength&gt;offset Then
            drawText(Text,mscrollposition,yPostition,Color)
            mscrollposition=mscrollposition-1
            If mscrollposition&lt; 0-TextLength  Then
                If LockApp And callFinish Then
                    finish
                    Return
                Else
                    mscrollposition=MatrixWidth
                End If
            End If
        Else
            Dim x As Int
            If TextLength&lt;offset+1 Then
                If IconOffset Then
                    x=((MatrixWidth/2)-TextLength/2)+4
                Else
                    x=(MatrixWidth/2)-TextLength/2
                End If
            End If
            drawText(Text,x,yPostition,Color)
        End If
    End Sub

    &#39;This functions build and savee the settings. You dont need to call this manually
    Public Sub makeSettings
        If Game Then show=False
        If File.Exists(File.Combine(File.DirApp,&quot;Apps&quot;),appName&amp;&quot;.ax&quot;) Then
            Dim data() As Byte = File.ReadBytes(File.Combine(File.DirApp,&quot;Apps&quot;),appName&amp;&quot;.ax&quot;)
            Dim m As Map = bc.ConvertBytesToObject(data)
            For Each k As String In appSettings.Keys
                If Not(m.ContainsKey(k)) Then
                    m.Put(k,appSettings.Get(k))
                Else
                    appSettings.Put(k,m.Get(k))
                End If
            Next
            For Counter = m.Size -1 To 0 Step -1
                Dim SettingsKey As String = m.GetKeyAt(Counter)
                If Not(SettingsKey=&quot;UpdateInterval&quot; Or SettingsKey=&quot;StartTime&quot; Or SettingsKey=&quot;EndTime&quot; Or SettingsKey=&quot;DisplayTime&quot; Or SettingsKey=&quot;Enabled&quot;)   Then
                    If Not(appSettings.ContainsKey(SettingsKey)) Then m.Remove(SettingsKey)
                End If
            Next
            Try
                Enabled=m.Get(&quot;Enabled&quot;)
                startTime=m.Get(&quot;StartTime&quot;)
                endtime=m.Get(&quot;EndTime&quot;)
                UpdateInterval=m.Get(&quot;UpdateInterval&quot;)
                DisplayTime=m.Get(&quot;DisplayTime&quot;)
                File.WriteBytes(File.Combine(File.DirApp,&quot;Apps&quot;),appName&amp;&quot;.ax&quot;,bc.ConvertObjectToBytes(m))
                If SubExists(Target,event&amp;&quot;_settingsChanged&quot;) Then
                    CallSub(Target,event&amp;&quot;_settingsChanged&quot;)&#39;ignore
                End If
            Catch
                Log(&quot;Got Error from &quot; &amp; appName)
                Log(&quot;Error while saving settings&quot;)
                Log(LastException)
            End Try
        Else
            Dim m As Map
            m.Initialize
            m.Put(&quot;UpdateInterval&quot;,UpdateInterval)
            m.Put(&quot;StartTime&quot;,&quot;00:00&quot;)
            m.Put(&quot;EndTime&quot;,&quot;00:00&quot;)
            m.Put(&quot;DisplayTime&quot;,&quot;0&quot;)
            m.Put(&quot;Enabled&quot;,True)
            For Each k As String In appSettings.Keys
                m.Put(k,appSettings.Get(k))
            Next
            File.WriteBytes(File.Combine(File.DirApp,&quot;Apps&quot;),appName&amp;&quot;.ax&quot;,bc.ConvertObjectToBytes(m))
        End If
    End Sub

    &#39;Returns the value of a Settingskey
    public Sub get(SettingsKey As String) As Object
        If appSettings.ContainsKey(SettingsKey) Then
            Return appSettings.Get(SettingsKey)
        Else
            Log(SettingsKey &amp; &quot; not found&quot;)
            Return &quot;&quot;
        End If
    End Sub

    Public Sub  saveSingleSetting(key As String, value As Object)
        If File.Exists(File.Combine(File.DirApp,&quot;Apps&quot;),appName&amp;&quot;.ax&quot;) Then
            Dim data() As Byte = File.ReadBytes(File.Combine(File.DirApp,&quot;Apps&quot;),appName&amp;&quot;.ax&quot;)
            Dim m As Map = bc.ConvertBytesToObject(data)
            m.Put(key,value)
            File.WriteBytes(File.Combine(File.DirApp,&quot;Apps&quot;),appName&amp;&quot;.ax&quot;,bc.ConvertObjectToBytes(m))
        End If
    End Sub


    &#39;Draws a Bitmap
    Public Sub drawBMP(x As Int,y As Int,bmp() As Short,width As Int, height As Int)
        commandList.Add(CreateMap(&quot;type&quot;:&quot;bmp&quot;,&quot;x&quot;:x,&quot;y&quot;:y,&quot;bmp&quot;:bmp,&quot;width&quot;:width,&quot;height&quot;:height))
    End Sub

    &#39;Draws a Text
    Public Sub drawText(text As String,x As Int, y As Int,Color() As Int)
        If Color=Null Then
            commandList.Add(CreateMap(&quot;type&quot;:&quot;text&quot;,&quot;text&quot;:text,&quot;x&quot;:x,&quot;y&quot;:y))
        Else
            commandList.Add(CreateMap(&quot;type&quot;:&quot;text&quot;,&quot;text&quot;:text,&quot;x&quot;:x,&quot;y&quot;:y,&quot;color&quot;:Color))
        End If
    End Sub

    &#39;Draws a Circle
    Public Sub drawCircle(X As Int, Y As Int, Radius As Int, Color() As Int)
        If Color=Null Then
            commandList.Add(CreateMap(&quot;type&quot;:&quot;circle&quot;,&quot;x&quot;:x,&quot;y&quot;:y,&quot;r&quot;:Radius,&quot;color&quot;:SystemColor))
        Else
            commandList.Add(CreateMap(&quot;type&quot;:&quot;circle&quot;,&quot;x&quot;:x,&quot;y&quot;:y,&quot;r&quot;:Radius,&quot;color&quot;:Color))
        End If
    End Sub

    &#39;Draws a filled Circle
    Public Sub fillCircle(X As Int, Y As Int, Radius As Int, Color() As Int)
        If Color=Null Then
            commandList.Add(CreateMap(&quot;type&quot;:&quot;fillCircle&quot;,&quot;x&quot;:x,&quot;y&quot;:y,&quot;r&quot;:Radius,&quot;color&quot;:SystemColor))
        Else
            commandList.Add(CreateMap(&quot;type&quot;:&quot;fillCircle&quot;,&quot;x&quot;:x,&quot;y&quot;:y,&quot;r&quot;:Radius,&quot;color&quot;:Color))
        End If
    End Sub

    &#39;Draws a single Pixel
    Public Sub drawPixel(X As Int,Y As Int,Color() As Int)
        If Color=Null Then
            commandList.Add(CreateMap(&quot;type&quot;:&quot;pixel&quot;,&quot;x&quot;:x,&quot;y&quot;:y,&quot;color&quot;:SystemColor))
        Else
            commandList.Add(CreateMap(&quot;type&quot;:&quot;pixel&quot;,&quot;x&quot;:x,&quot;y&quot;:y,&quot;color&quot;:Color))
        End If
    End Sub

    &#39;Draws a Rectangle
    Public Sub drawRect(X As Int,Y As Int,Width  As Int,Height As Int,Color() As Int)
        If Color=Null Then
            commandList.Add(CreateMap(&quot;type&quot;:&quot;rect&quot;,&quot;x&quot;:x,&quot;y&quot;:y,&quot;w&quot;:Width,&quot;h&quot;:Height,&quot;color&quot;:SystemColor))
        Else
            commandList.Add(CreateMap(&quot;type&quot;:&quot;rect&quot;,&quot;x&quot;:x,&quot;y&quot;:y,&quot;w&quot;:Width,&quot;h&quot;:Height,&quot;color&quot;:Color))
        End If
    End Sub

    &#39;Draws a Line
    Public Sub drawLine(X0 As Int,Y0 As Int,X1  As Int,Y1 As Int,Color() As Int)
        If Color=Null Then
            commandList.Add(CreateMap(&quot;type&quot;:&quot;line&quot;,&quot;x0&quot;:X0,&quot;y0&quot;:Y0,&quot;x1&quot;:X1,&quot;y1&quot;:Y1,&quot;color&quot;:SystemColor))
        Else
            commandList.Add(CreateMap(&quot;type&quot;:&quot;line&quot;,&quot;x0&quot;:X0,&quot;y0&quot;:Y0,&quot;x1&quot;:X1,&quot;y1&quot;:Y1,&quot;color&quot;:Color))
        End If
    End Sub

    &#39;Sends a custom or undocumented command
    Public Sub customCommand(cmd As Map)
        commandList.Add(cmd)
    End Sub

    &#39;Fills the screen with a color
    Public Sub fill(Color() As Int)
        If Color=Null Then
            commandList.Add(CreateMap(&quot;type&quot;:&quot;fill&quot;,&quot;color&quot;:SystemColor))
        Else
            commandList.Add(CreateMap(&quot;type&quot;:&quot;fill&quot;,&quot;color&quot;:Color))
        End If
    End Sub

    &#39;Exits the app and force AWTRIX to switch to the next App
    &#39;only needed if you have set LockApp to true
    Public Sub finish
        finishApp=True
    End Sub

    &#39;Returns a rainbowcolor wich is fading each tick
    Public Sub rainbow As Int()
        colorCounter=colorCounter+1
        If colorCounter&gt;255 Then colorCounter=0
        Return(wheel(colorCounter))
    End Sub

    Private Sub wheel(Wheelpos As Int) As Int() &#39;ignore
        If(Wheelpos &lt; 85) Then
            Return Array As Int(Wheelpos * 3, 255 - Wheelpos * 3, 0)
        else if(Wheelpos &lt; 170) Then
            Wheelpos =Wheelpos- 85
            Return  Array As Int(255 - Wheelpos * 3, 0, Wheelpos * 3)
        Else
            Wheelpos =Wheelpos- 170
            Return  Array As Int(0, Wheelpos * 3, 255 - Wheelpos * 3)
        End If
    End Sub

    Public Sub Logger(msg As String)
        If verboseLog Then
            DateTime.DateFormat=DateTime.DeviceDefaultTimeFormat
            Log(DateTime.Date(DateTime.Now) &amp;&quot;      &quot; &amp; appName &amp; &quot;:&quot; &amp; CRLF &amp;  msg)
        End If
    End Sub

    Private Sub Control(controller As Map)
        If controller.ContainsKey(&quot;GameStart&quot;) And Game Then
            Dim state As Boolean = controller.Get(&quot;GameStart&quot;)
            If state Then
                show=True
            Else
                finishApp=True
                show=False
            End If
            Return
        End If

        If controller.ContainsKey(&quot;button&quot;) Then
            Dim buttonNR As Int = controller.Get(&quot;button&quot;)
            Dim buttonDIR As Boolean = controller.Get(&quot;dir&quot;)
            If SubExists(Target,event&amp;&quot;_controllerButton&quot;) Then
                CallSub3(Target,event&amp;&quot;_controllerButton&quot;,buttonNR,buttonDIR)
            End If
            If verboseLog Then
                If buttonDIR Then Logger($&quot;Button ${buttonNR} down&quot;$) Else Logger($&quot;Button ${buttonNR} up&quot;$)
            End If
            Return
        End If

        If controller.ContainsKey(&quot;axis&quot;) Then
            Dim AxisNR As Int = controller.Get(&quot;axis&quot;)
            Dim val As Float = controller.Get(&quot;dir&quot;)
            If SubExists(Target,event&amp;&quot;_controllerAxis&quot;) Then
                CallSub3(Target,event&amp;&quot;_controllerAxis&quot;,AxisNR,val)
            End If
            Return
        End If
    End Sub

    Private Sub externalCommand(cmd As Map)
        If SubExists(Target,event&amp;&quot;_externalCommand&quot;) Then
            CallSub2(Target,event&amp;&quot;_externalCommand&quot;,cmd)
        End If
    End Sub

    Public Sub throwError(message As String)
        Logger(message)
    End Sub

    &#39;Returns the timestamp when the app was started.
    Sub getstartedAt As Long
        Return startTimestamp
    End Sub

    &#39;Gets or sets the app tags
    Sub gettags As List
        Return Tag
    End Sub

    Sub settags(Tags As List)
        Tag=Tags
    End Sub

    &#39;Returns the runtime of the app
    Sub getduration As Int
        Return Appduration
    End Sub

    &#39;If set to true, awtrix will skip this app
    Sub setshouldShow(shouldShow As Boolean)
        show=shouldShow
    End Sub

    &#39;If set to true, AWTRIX will download new data before each start.
    Sub setforceDownload(forceDownload As Boolean)
        forceDown=forceDownload
    End Sub

    &#39;If set to true AWTRIX will wait for the &quot;finish&quot; command before switch to the next app.
    Sub setlock(lock As Boolean)
        LockApp=lock
    End Sub

    &#39;IconIDs from AWTRIXER. You can add multiple if you need more
    Sub seticons(icons As List)
        Icon=icons
    End Sub

    &#39;Sets or gets the appname
    Sub getname As String
        Return appName
    End Sub

    Sub setname(name As String)
        appName=name
    End Sub

    &#39;Sets or gets the app description
    Sub getdescription As String
        Return AppDescription
    End Sub

    Sub setdescription(description As String)
        AppDescription=description
    End Sub

    &#39;The developer if this App
    Sub getauthor As String
        Return AppAuthor
    End Sub

    Sub setauthor(author As String)
        AppAuthor=author
    End Sub

    &#39;Sets or gets the appversion
    Sub getversion As String
        Return AppVersion
    End Sub

    Sub setversion(version As String)
        AppVersion=version
    End Sub

    &#39;Sets or gets the tickinterval
    Sub gettick As String
        Return TickInterval
    End Sub

    Sub settick(tick As String)
        TickInterval=tick
    End Sub

    &#39;How many downloadhandlers should be generated
    Sub setdownloads(downloads As Int)
        NeedDownloads=downloads
    End Sub

    &#39;Setup Instructions. You can use HTML to format it
    Sub setsetupDescription(setupDescription As String)
        SetupInfos=setupDescription
    End Sub

    &#39;gets all informations from the matrix as a map
    Sub getmatrix As Map
        Return MatrixInfo
    End Sub

    &#39;needed Settings for this App (wich can be configurate from user via webinterface)
    Sub setsettings(settings As Map)
        appSettings=settings
    End Sub

    &#39;returns the version of the serever
    Sub getserver As String
        Return ServerVersion
    End Sub

    &#39;returns the size of the Matrix as an array (height,width)
    Sub getmatrixSize As Int()
        Dim size() As Int = Array As Int(MatrixHeight,MatrixWidth)
        Return size
    End Sub

    &#39;if this is a game you can set your play instructions here
    Sub sethowToPlay(howToPlay As String)
        playdescription=howToPlay
    End Sub

    &#39;Icon (ID) to be displayed in the Appstore and MyApps
    Sub setcoverIcon(coverIcon As Int)
        Cover=coverIcon
    End Sub

    &#39;set this to true if this is a game.
    Sub setisGame(isGame As Boolean)
        Game=isGame
    End Sub

    public Sub InitializeOAuth (AuthorizeURL As String, TokenURL As String, ClientId As String, ClientSecret As String, Scope As String)
        OAuth=True
        oauthmap=CreateMap(&quot;AuthorizeURL&quot;:AuthorizeURL,&quot;TokenURL&quot;:TokenURL,&quot;ClientId&quot;:ClientId,&quot;ClientSecret&quot;:ClientSecret,&quot;Scope&quot;:Scope)
    End Sub

    Sub getToken As String
        Return OAuthToken
    End Sub

    Sub getScrollposition As Int
        Return mscrollposition
    End Sub

    &#39;Sends a POST request with the given data as the post data.
    Public Sub PostString(Link As String, Text As String)
        httpMap=CreateMap(&quot;type&quot;:&quot;PostString&quot;,&quot;Link&quot;:Link,&quot;Text&quot;:Text)
    End Sub

    &#39;Sends a POST request with the given string as the post data
    Public Sub PostBytes(Link As String, Data() As Byte)
        httpMap=CreateMap(&quot;type&quot;:&quot;PostBytes&quot;,&quot;Link&quot;:Link,&quot;Data&quot;:Data)
    End Sub

    &#39;Sends a PUT request with the given data as the post data.
    Public Sub PutString(Link As String, Text As String)
        httpMap=CreateMap(&quot;type&quot;:&quot;PutString&quot;,&quot;Link&quot;:Link,&quot;Text&quot;:Text)
    End Sub

    &#39;Sends a PUT request with the given string as the post data
    Public Sub PutBytes(Link As String, Data() As Byte)
        httpMap=CreateMap(&quot;type&quot;:&quot;PutBytes&quot;,&quot;Link&quot;:Link,&quot;Data&quot;:Data)
    End Sub

    &#39;Sends a PATCH request with the given string as the request payload.
    Public Sub PatchString(Link As String, Text As String)
        httpMap=CreateMap(&quot;type&quot;:&quot;PatchString&quot;,&quot;Link&quot;:Link,&quot;Text&quot;:Text)
    End Sub

    &#39;Sends a PATCH request with the given data as the request payload.
    Public Sub PatchBytes(Link As String, Data() As Byte)
        httpMap=CreateMap(&quot;type&quot;:&quot;PatchBytes&quot;,&quot;Link&quot;:Link,&quot;Data&quot;:Data)
    End Sub

    &#39;Sends a HEAD request.
    Public Sub Head(Link As String)
        httpMap=CreateMap(&quot;type&quot;:&quot;Head&quot;,&quot;Link&quot;:Link)
    End Sub

    &#39;Sends a multipart POST request.
    &#39;NameValues - A map with the keys and values. Pass Null if not needed.
    &#39;Files - List of MultipartFileData items. Pass Null if not needed.
    Public Sub PostMultipart(Link As String, NameValues As Map, Files As List)
        httpMap=CreateMap(&quot;type&quot;:&quot;PostMultipart&quot;,&quot;Link&quot;:Link,&quot;NameValues&quot;:NameValues,&quot;Files&quot;:Files)
    End Sub

    &#39;Sends a POST request with the given file as the post data.
    &#39;This method doesn&#39;t work with assets files.
    Public Sub PostFile(Link As String, Dir As String, FileName As String)
        httpMap=CreateMap(&quot;type&quot;:&quot;PostFile&quot;,&quot;Link&quot;:Link,&quot;Dir&quot;:Dir,&quot;FileName&quot;:FileName)
    End Sub

    &#39;Submits a HTTP GET request.
    &#39;Consider using Download2 if the parameters should be escaped.
    Public Sub Download(Link As String)
        httpMap=CreateMap(&quot;type&quot;:&quot;Download&quot;,&quot;Link&quot;:Link)
    End Sub

    &#39;Submits a HTTP GET request.
    &#39;Encodes illegal parameter characters.
    &#39;&lt;code&gt;Example:
    &#39;job.Download2(&quot;http://www.example.com&quot;, _
    &#39;    Array As String(&quot;key1&quot;, &quot;value1&quot;, &quot;key2&quot;, &quot;value2&quot;))&lt;/code&gt;
    Public Sub Download2(Link As String, Parameters() As String)
        httpMap=CreateMap(&quot;type&quot;:&quot;Download2&quot;,&quot;Link&quot;:Link,&quot;Parameters&quot;:Parameters)
    End Sub

    &#39;Sets the header for the request as an map
    &#39;(Headername,Headervalue)
    Public Sub setHeader(header As Map)
        DownloadHeader=header
    End Sub

    &#39;Sets the Mime header of the request.
    &#39;This method should only be used with requests that have a payload.
    Public Sub SetContentType(ContentType As String)
        mContentType=ContentType
    End Sub

    &#39;enables pollingmode
    &#39;pass the subname wich should be called every 5s. e.g for App_mySub :
    &#39;&lt;code&gt;app.pollig(&quot;mySub&quot;):&lt;/code&gt;
    &#39;if you pass a empty String (&quot;&quot;) AWTRIX will start the download
    Public Sub polling(enable As Boolean,subname As String)
        poll=CreateMap(&quot;enable&quot;:enable,&quot;sub&quot;:subname)
    End Sub


    &#39;hide this app from apploop
    Sub setHidden(hide As Boolean)
        mHidden=hide
    End Sub




</code></pre>
<ol start="2">
<li>BlogViews.b4j: b4j 工程配置文件</li>
</ol>
<pre><code class="text">    AppType=StandardJava
    Build1=Default,b4j.example
    Group=Default Group
    Library1=jcore
    Library2=json
    Library3=jrandomaccessfile
    Module1=AWTRIX
    Module2=BlogViews
    NumberOfFiles=0
    NumberOfLibraries=3
    NumberOfModules=2
    Version=8.5
    @EndOfDesignText@
    &#39;Draws a Rectangle&#39;Non-UI application (console / server application)
    #Region Project Attributes 
        #LibraryName:BlogViews
    #End Region

    Sub Process_Globals

    End Sub

    Sub AppStart (Args() As String)

    End Sub

    &#39;Return true to allow the default exceptions handler to handle the uncaught exception.
    Sub Application_Error (Error As Exception, StackTrace As String) As Boolean
        Return True
    End Sub
</code></pre>
<p>其中修改：</p>
<ul>
<li>Module2</li>
<li>LibraryName</li>
</ul>
<ol start="3">
<li>BlogViews.bas： 程序主文件</li>
</ol>
<pre><code class="text">    B4J=true
    Group=Default Group
    ModulesStructureVersion=1
    Type=Class
    Version=4.2
    @EndOfDesignText@

    Sub Class_Globals
        Dim App As AWTRIX

        &#39;Declare your variables here
        Dim followers As Int = 0
        Dim iconId As Int = 8
    End Sub

    &#39; ignore
    public Sub GetNiceName() As String
        Return App.Name
    End Sub

    &#39; ignore
    public Sub Run(Tag As String, Params As Map) As Object
        Return App.interface(Tag,Params)
    End Sub

    &#39; Config your App
    Public Sub Initialize() As String

        App.Initialize(Me,&quot;App&quot;)

        &#39;App name (must be unique, avoid spaces)
        App.Name=&quot;BlogViews&quot;

        &#39;Version of the App
        App.Version=&quot;1.0&quot;

        &#39;Description of the App. You can use HTML to format it
        App.Description=$&quot;Shows your website unique visitor on &lt;b&gt;busuanzi&lt;/b&gt; statistical tools&quot;$

        App.Author=&quot;JoyLau&quot;

        App.CoverIcon=iconId

        &#39;SetupInstructions. You can use HTML to format it
        App.setupDescription= $&quot;
        &lt;b&gt;Website:&lt;/b&gt;  Your Website Address&lt;br/&gt;
        &lt;b&gt;IconID:&lt;/b&gt;  Icon id&lt;br/&gt;
        &quot;$

        &#39;How many downloadhandlers should be generated
        App.Downloads=1

        &#39;IconIDs from AWTRIXER. You can add multiple if you want to display them at the same time
        App.Icons=Array As Int(iconId)

        &#39;Tickinterval in ms (should be 65 by default, for smooth scrolling))p://
        App.Tick=65

        &#39;needed Settings for this App (Wich can be configurate from user via webinterface)
        App.settings=CreateMap(&quot;Website&quot;:&quot;http://blog.joylau.cn&quot;,&quot;IconID&quot;:iconId)

        App.MakeSettings
        Return &quot;AWTRIX20&quot;
    End Sub

    &#39;this sub is called right before AWTRIX will display your App
    Sub App_Started

    End Sub

    &#39;Called with every update from Awtrix
    &#39;return one URL for each downloadhandler
    Sub App_startDownload(jobNr As Int)
        Select jobNr
            Case 1
                App.Download(&quot;http://busuanzi.ibruce.info/busuanzi?jsonpCallback=callback&quot;)
                App.Header = CreateMap(&quot;Referer&quot;:App.Get(&quot;Website&quot;),&quot;Cookie&quot;:&quot;busuanziId=D58737A150864C68B83F962028616CD6&quot;)
        End Select
    End Sub

    &#39;process the response from each download handler
    &#39;if youre working with JSONs you can use this online parser
    &#39;to generate the code automaticly
    &#39;https://json.blueforcer.de/ 
    Sub App_evalJobResponse(Resp As JobResponse)
        Try
            If Resp.success Then
                Select Resp.jobNr
                    Case 1
                        Dim parser As JSONParser
                        parser.Initialize(Resp.ResponseString.replace(&quot;try{callback(&quot;,&quot;&quot;).replace(&quot;);}catch(e){}&quot;,&quot;&quot;))
                        Dim root As Map = parser.NextObject
                        followers = root.Get(&quot;site_uv&quot;)
                End Select
            End If
        Catch
            Log(&quot;Error in: &quot;&amp; App.Name &amp; CRLF &amp; LastException)
            Log(&quot;API response: &quot; &amp; CRLF &amp; Resp.ResponseString)
        End Try
    End Sub

    &#39;this sub is called right before AWTRIX will display your App
    Sub App_iconRequest
        App.Icons=Array As Int(App.Get(&quot;IconID&quot;))
    End Sub

    &#39;With this sub you build your frame.
    Sub App_genFrame
        App.genText(followers,True,1,Null,True)
        App.drawBMP(0,0,App.getIcon(App.Get(&quot;IconID&quot;)),8,8)
    End Sub</code></pre>
<p>配置项解释：</p>
<ol>
<li>App.name： 应用程序的名称。在Appstore，MyApps和文件名中使用  </li>
<li>App.version： 应用程序的版本。版本必须是数字，并且最多可以包含2个小数位（例如1.25）  </li>
<li>App.description： 应用程序的描述，简要地描述应用。可以选择将文本格式设置为HTML  </li>
<li>App.author： 应用程序的创建者。  </li>
<li>App.coverIcon：应用程序的图标。数据库中的 IconID。也可以在 Web 页面里创建并上传自己的图标  </li>
<li>App.settings： 应用程序的设置。生成一个由键和值组成的映射。例如```CreateMap（“ Key”：“ Value”）``可以输入缺省值，以便应用可以立即启动，也可以将值保留为空（“”），以便 AWTRIX 通知用户需要调整。在设置之前，AWTRIX 将不会加载该应用程序！  </li>
<li>App.setupDescription： 简要说明如何设置应用程序。可以将文本格式设置为HTML  </li>
<li>App.downloads： 指定您的应用需要下载多少次。如果一个下载依赖于另一下载，则需要多次下载。 </li>
<li>App.icons： 指定应用程序需要的图标。在启动应用程序之前，这些也将由 AWTRIX 下载。 </li>
<li>App.tick： 指定应用程序应运行的速度。对于简单的文本，65（ms）是最适合的。  </li>
</ol>
<p>程序解释： </p>
<ol>
<li>设置默认的访问量 0，默认使用的图标 id: 1230  </li>
<li>App 运行时请求接口： <a href="http://busuanzi.ibruce.info/busuanzi?jsonpCallback=callback，" target="_blank" rel="noopener">http://busuanzi.ibruce.info/busuanzi?jsonpCallback=callback，</a> 需要带上头信息 Referer，和 Cookie  </li>
</ol>
<p>Referer： 模拟浏览器请求，否则的话不蒜子的接口将不可用<br>Cookie： 带上 Cookie 的话相当于用户一直在刷新网页的效果，此时独立访客数不会 +1 的， 不带上的话每次访问接口都是导致数目 +1 ,造成数量不准确  </p>
<ol start="3">
<li>解析返回的回调信息字符串结果， 获取想要的数据 <code>site_uv</code></li>
</ol>
<h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><ol>
<li>将以上项目导入 B4J</li>
<li>点击 <code>Tools</code> -&gt; <code>Configure Paths</code> , 设置 javac 的目录和 jar 包导出目录(Additional Libraries)</li>
<li>编译 jar 包： 点击 <code>Project</code> -&gt; <code>Compile to Library</code></li>
</ol>
<h3 id="手动安装"><a href="#手动安装" class="headerlink" title="手动安装"></a>手动安装</h3><ol>
<li>将已编译的 <code>jar</code> 包复制到服务端的 <code>Apps</code> 文件夹中</li>
<li>在 Awtrix Web 界面重新启动 AWTRIX</li>
</ol>
<pre><code class="bash">    reload apps</code></pre>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls"
                data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
            <ul id="audio-list" style="display:none">
                
                
                <li title='0' data-url='/statics/chengdu.mp3'></li>
                
                    
            </ul>
            
            
            
    <div id='gitalk-container' class="comment link"
        data-ae='true'
        data-ci='d9218a69d0b64a6a69b4'
        data-cs='1ff13ada2c9062d823689a5fef4bb431f257916b'
        data-r='blog'
        data-o='JoyLau'
        data-a='JoyLau'
        data-d=''
    >留言</div>


            
            
        </div>
        <div class="sidebar">
            <div class="box animated fadeInRight">
                <div class="subbox">
                    <img src="http://image.joylau.cn/blog/JoyLau.jpg" height=300 width=300></img>
                    <p>JoyLau</p>
                    <span>整理一些在项目中用到的小知识或者技术点做一个总结及叙述，希望通过这些记录，能够将自己的学习成果归纳出来，对这些技术进行备忘，以便日后查询</span>
                    <dl>
                        <dd><a href="mailto:2587038142.liu@gmail.com" target="_blank"><span
                                        class=" iconfont icon-email-fill"></span></a></dd>
                        <dd><a href="https://github.com/JoyLau" target="_blank"><span
                                    class=" iconfont icon-github"></span></a></dd>
                        <dd><a href="https://twitter.com/FailingLiu" target="_blank"><span
                                    class=" iconfont icon-twitter"></span></a></dd>
                    </dl>
                </div>
                <ul>
                    <li><a href="/">222 <p>文章</p></a></li>
                    <li><a href="/categories">49 <p>分类</p></a></li>
                    <li><a href="/tags">106 <p>标签</p></a></li>
                </ul>
            </div>
            
            
            
            <div class="box sticky animated fadeInRight faster">
                <div id="toc" class="subbox">
                    <h4>目录</h4>
                    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#说明"><span class="toc-number">1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#环境准备"><span class="toc-number">2.</span> <span class="toc-text">环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#效果图"><span class="toc-number">3.</span> <span class="toc-text">效果图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#开发准备"><span class="toc-number">4.</span> <span class="toc-text">开发准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译"><span class="toc-number">5.</span> <span class="toc-text">编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#手动安装"><span class="toc-number">6.</span> <span class="toc-text">手动安装</span></a></li></ol>
                </div>
            </div>
            
            
        </div>
    </div>
</div>

    </div>
</div>
    <div id="back-to-top" class="animated fadeIn faster">
        <div class="flow"></div>
        <span class="percentage animated fadeIn faster">0%</span>
        <span class="iconfont icon-top02 animated fadeIn faster"></span>
    </div>
</body>
<footer>
    <p class="copyright">
        <span title="本站访问量"><span class=" iconfont icon-yonghu"> </span> <span id="busuanzi_value_site_pv" class="gradient-text"></span></span> | <span title="本页阅读量"><span class="iconfont icon-eye"> </span> <span id="busuanzi_value_page_pv" class="gradient-text"></span></span>
    </p>
    <p class="copyright" id="copyright">
        &copy; 2017 - 2021
        <span class="gradient-text">
            JoyLau
        </span>.
        Powered by
        <span class="gradient-text">
            Hexo
        </span>
        Theme
        <span class="gradient-text">
            Obsidian
        </span>
    </p>
</footer>

    
<link rel="stylesheet" href="/css/gitalk/1.5.0/gitalk.min.css">

    
<script src="/js/gitalk/1.5.0/gitalk.min.js"></script>





<script src="//cdn.bootcss.com/codemirror/5.53.2/codemirror.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/javascript/javascript.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/css/css.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/xml/xml.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/htmlmixed/htmlmixed.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/clike/clike.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/php/php.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/shell/shell.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/python/python.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/yaml/yaml.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/groovy/groovy.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/sql/sql.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/jsx/jsx.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/powershell/powershell.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/nginx/nginx.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.53.2/mode/http/http.min.js"></script>



<script src="/js/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/obsidian.js"></script>
<script src="/js/jquery.truncate.js"></script>
<script src="/js/search.js"></script>


<script src="/js/typed.js/2.0.10/typed.min.js"></script>


<script src="/js/blueimp-md5/2.12.0/js/md5.min.js"></script>


<script src="/js/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>




    
<script src="/js/busuanzi.js"></script>

    <script>
        $(document).ready(function () {
            if ($('span[id^="busuanzi_"]').length) {
                initialBusuanzi();
            }
        });
    </script>



<link rel="stylesheet" href="/css/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="/css/photoswipe/4.1.3/default-skin/default-skin.min.css">


<script src="/js/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="/js/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>







<script>
    function initialTyped () {
        var typedTextEl = $('.typed-text');
        if (typedTextEl && typedTextEl.length > 0) {
            var typed = new Typed('.typed-text', {
                strings: ["Think like an artist, develop like an artisan", "艺术家思维去思考问题，工匠创造精神去开发"],
                typeSpeed: 90,
                loop: true,
                loopCount: Infinity,
                backSpeed: 20,
            });
        }
    }

    if ($('.article-header') && $('.article-header').length) {
        $(document).ready(function () {
            initialTyped();
        });
    }
</script>



  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?691c26474b1733df80dca4dfa7ba5536";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


</html>
